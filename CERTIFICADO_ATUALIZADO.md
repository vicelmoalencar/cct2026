# ‚úÖ Certificado Atualizado - CCT 2026

## üìã Resumo das Altera√ß√µes

O certificado foi completamente reformulado para incluir:

1. ‚úÖ **Logotipo da Empresa** - SVG embutido no cabe√ßalho
2. ‚úÖ **Nome da Empresa** - CENTRO DE ENSINO E APRENDIZAGEM PLUS LTDA
3. ‚úÖ **CNPJ** - 35.537.045/0001-84
4. ‚úÖ **Assinatura da Diretora** - N√ÅRGILA DE SOUZA SANTOS
5. ‚úÖ **M√≥dulos do Curso** - Lista de todos os m√≥dulos conclu√≠dos
6. ‚úÖ **Layout Profissional** - Otimizado para impress√£o A4 landscape

---

## üé® Novo Design do Certificado

### **Cabe√ßalho**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [LOGO SVG]  CENTRO DE ENSINO E           CCT 2026     ‚îÇ
‚îÇ              APRENDIZAGEM PLUS LTDA                     ‚îÇ
‚îÇ              CNPJ: 35.537.045/0001-84                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Corpo do Certificado**
- T√≠tulo: **CERTIFICADO**
- Nome do aluno com destaque azul
- Nome do curso em negrito
- **NOVA SE√á√ÉO: M√≥dulos Conclu√≠dos**
  - Lista todos os m√≥dulos do curso
  - Cada m√≥dulo com √≠cone de check verde
  - Grid responsivo (2 colunas)
- Detalhes: Carga hor√°ria, Data de Conclus√£o, Data de Emiss√£o

### **Rodap√©**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  _________________________    _____________________   ‚îÇ
‚îÇ  N√ÅRGILA DE SOUZA SANTOS     Sistema CCT 2026        ‚îÇ
‚îÇ  Diretora                    Certifica√ß√£o Digital    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **C√≥digo de Verifica√ß√£o**
- Canto inferior direito
- Formato: CCT-YYYY-XXXXXXXX
- URL de verifica√ß√£o p√∫blica

---

## üóÑÔ∏è Estrutura de Dados

### **Migration 0014: Campo course_modules**

```sql
ALTER TABLE certificates 
ADD COLUMN IF NOT EXISTS course_modules TEXT;
```

**Formato JSON armazenado:**
```json
[
  {"title": "M√≥dulo 1 - Introdu√ß√£o", "order": 1},
  {"title": "M√≥dulo 2 - Conte√∫do Principal", "order": 2},
  {"title": "M√≥dulo 3 - Conclus√£o", "order": 3}
]
```

### **Busca de M√≥dulos**

O sistema busca m√≥dulos de **duas formas**:

1. **Priorit√°rio**: Campo `course_modules` (JSON pr√©-armazenado)
2. **Fallback**: Busca na tabela `modules` por `course_id`

```typescript
// C√≥digo no backend (src/index.tsx)
let modules: string[] = []

// 1. Tenta usar JSON armazenado
if (cert.course_modules) {
  const modulesData = JSON.parse(cert.course_modules)
  modules = modulesData.map(m => m.title)
}

// 2. Busca no banco se n√£o houver JSON
if (modules.length === 0 && cert.course_id) {
  const courseModules = await supabase.query('modules', {
    filters: { course_id: cert.course_id },
    order: 'order_index.asc'
  })
  modules = courseModules.map(m => m.title)
}
```

---

## üöÄ Como Popular os M√≥dulos nos Certificados Existentes

### **Op√ß√£o 1: Via SQL (RECOMENDADO)**

Execute o script: `migrations/POPULAR_MODULOS_CERTIFICADOS.sql`

```sql
-- Atualiza TODOS os certificados que t√™m course_id
UPDATE certificates c
SET course_modules = (
  SELECT json_agg(
    json_build_object('title', m.title, 'order', m.order_index)
    ORDER BY m.order_index
  )::TEXT
  FROM modules m
  WHERE m.course_id = c.course_id
)
WHERE c.course_id IS NOT NULL
  AND (c.course_modules IS NULL OR c.course_modules = '')
  AND EXISTS (SELECT 1 FROM modules m WHERE m.course_id = c.course_id);
```

### **Op√ß√£o 2: Autom√°tico no Runtime**

Se o certificado **N√ÉO** tiver `course_modules` mas **tiver** `course_id`:
- O sistema busca automaticamente os m√≥dulos ao gerar o HTML
- Os m√≥dulos aparecem no certificado mesmo sem estar pr√©-armazenados
- **Desvantagem**: Faz query adicional no banco a cada gera√ß√£o

### **Op√ß√£o 3: Via Admin Panel (FUTURO)**

Interface para:
- Adicionar/remover m√≥dulos manualmente
- Editar ordem dos m√≥dulos
- Popular em lote

---

## üìÑ Onde os M√≥dulos Aparecem

### **1. Certificado HTML Individual**
- URL: `/api/certificates/:id/html`
- Acesso: Somente dono do certificado
- Uso: Visualizar e baixar PDF (Ctrl+P)
- M√≥dulos: ‚úÖ Exibidos

### **2. P√°gina de Verifica√ß√£o P√∫blica**
- URL: `/verificar/:code`
- Acesso: Qualquer pessoa com o c√≥digo
- Uso: Validar autenticidade
- M√≥dulos: ‚úÖ Exibidos

### **3. API de Verifica√ß√£o (JSON)**
- URL: `/api/verify/:code`
- Retorno: Dados do certificado em JSON
- M√≥dulos: ‚ùå N√£o inclu√≠dos (pode ser adicionado se necess√°rio)

---

## üé® Logotipo

### **Tipo**: SVG Inline (embutido no HTML)
### **Localiza√ß√£o**: Cabe√ßalho do certificado
### **Design**: 
- C√≠rculo com gradiente azul (#3498db ‚Üí #2c3e50)
- S√≠mbolo de educa√ß√£o (livro/diploma estilizado)
- Iniciais "EP" (Ensino Plus)

```svg
<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
  <circle cx="50" cy="50" r="45" fill="url(#grad1)"/>
  <path d="M 30 35 L 50 25 L 70 35 L 70 50 L 50 60 L 30 50 Z" fill="#fff"/>
  <circle cx="50" cy="50" r="8" fill="#fff"/>
  <text x="50" y="80" font-size="14" font-weight="bold" text-anchor="middle" fill="#fff">EP</text>
</svg>
```

**Por que SVG inline?**
- ‚úÖ Funciona no Cloudflare Workers (sem filesystem)
- ‚úÖ N√£o depende de arquivos externos
- ‚úÖ Escal√°vel sem perda de qualidade
- ‚úÖ Imprime perfeitamente em PDF

---

## üñ®Ô∏è Impress√£o/Download em PDF

### **Como Baixar:**
1. Usu√°rio clica em "Baixar PDF"
2. Sistema abre `/api/certificates/:id/html` em nova janela
3. Janela aguarda carregamento
4. Dispara `window.print()` automaticamente
5. Navegador abre di√°logo "Salvar como PDF"

### **CSS para Impress√£o:**
```css
@page {
  size: A4 landscape;
  margin: 0;
}

@media print {
  body {
    background: white;
  }
  .certificate-container {
    box-shadow: none;
  }
}
```

---

## üîç Verifica√ß√£o P√∫blica

### **URL de Verifica√ß√£o**
```
https://ensinoplus-dev-cct2026.n697dr.easypanel.host/verificar/CCT-2025-09F80B59
```

### **Informa√ß√µes Exibidas:**
- ‚úÖ Nome do aluno
- ‚úÖ Curso conclu√≠do
- ‚úÖ **M√≥dulos conclu√≠dos** (NOVO)
- ‚úÖ Carga hor√°ria
- ‚úÖ Data de conclus√£o
- ‚úÖ C√≥digo de verifica√ß√£o
- ‚úÖ Contador de verifica√ß√µes
- ‚úÖ Dados da empresa e CNPJ

---

## üì± Responsividade

### **Desktop (A4 Landscape)**
- Largura: 297mm
- Altura: 210mm
- 2 colunas para m√≥dulos

### **Mobile/Tablet**
- Grid adaptativo
- 1 coluna para m√≥dulos
- Fonte redimensionada

---

## üîß Arquivos Modificados

### **1. src/index.tsx**
- `generateCertificateHTML()` - Template atualizado
- `/api/certificates/:id/html` - Busca de m√≥dulos
- `/verificar/:code` - Exibi√ß√£o de m√≥dulos na verifica√ß√£o

### **2. migrations/0014_add_modules_to_certificates.sql**
- Adiciona coluna `course_modules`
- Cria √≠ndice para performance

### **3. migrations/POPULAR_MODULOS_CERTIFICADOS.sql**
- Script para popular m√≥dulos existentes
- 6 passos: verificar, testar, atualizar, validar

---

## ‚úÖ Checklist de Implementa√ß√£o

- [x] Criar migration 0014
- [x] Modificar fun√ß√£o `generateCertificateHTML()`
- [x] Adicionar busca de m√≥dulos no endpoint `/api/certificates/:id/html`
- [x] Adicionar m√≥dulos na p√°gina de verifica√ß√£o p√∫blica
- [x] Incluir logotipo SVG no cabe√ßalho
- [x] Adicionar nome da empresa e CNPJ
- [x] Incluir assinatura da diretora
- [x] Criar script SQL para popular m√≥dulos
- [x] Testar build e deploy
- [x] Commit e push para GitHub
- [ ] Aplicar migration 0014 no Supabase
- [ ] Popular m√≥dulos nos certificados existentes
- [ ] Rebuild no Easypanel
- [ ] Testar certificado em produ√ß√£o

---

## üöÄ Pr√≥ximos Passos

### **1. Aplicar Migration no Supabase**
```sql
-- Execute no SQL Editor do Supabase:
ALTER TABLE certificates 
ADD COLUMN IF NOT EXISTS course_modules TEXT;

CREATE INDEX IF NOT EXISTS idx_certificates_with_modules 
ON certificates(id) 
WHERE course_modules IS NOT NULL;
```

### **2. Popular M√≥dulos Existentes**
```sql
-- Execute: migrations/POPULAR_MODULOS_CERTIFICADOS.sql
-- Isso vai preencher course_modules para todos os certificados com course_id
```

### **3. Rebuild no Easypanel**
- Acessar dashboard do Easypanel
- Clicar em "Rebuild" no projeto cct2026
- Aguardar deploy (~2-5 minutos)

### **4. Testar em Produ√ß√£o**
```javascript
// No console do navegador (production):
fetch('/api/my-certificates')
  .then(r => r.json())
  .then(data => console.log(data.certificates))

// Abrir certificado:
window.open('/api/certificates/1/html', '_blank')
```

---

## üìû Suporte

Se encontrar problemas:

1. **M√≥dulos n√£o aparecem**: Verificar se `course_id` est√° preenchido
2. **Logotipo n√£o carrega**: √â SVG inline, sempre carrega
3. **PDF corta conte√∫do**: Verificar configura√ß√£o `@page` do CSS
4. **Verifica√ß√£o retorna 404**: C√≥digo de verifica√ß√£o inv√°lido

---

**√öltima Atualiza√ß√£o**: 2025-01-25  
**Vers√£o**: 2.0  
**Status**: ‚úÖ Implementado e Testado (Local)
