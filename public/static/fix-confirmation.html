<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corrigir Link de Confirmação - CCT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-900 via-blue-700 to-blue-500 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-8">
        <div class="text-center mb-6">
            <i class="fas fa-envelope-open-text text-6xl text-blue-600 mb-4"></i>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Corrigir Link de Confirmação</h1>
            <p class="text-gray-600">Cole o link que você recebeu no email e clique em corrigir</p>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                    <i class="fas fa-link mr-1"></i> Link do Email (localhost:3000)
                </label>
                <textarea 
                    id="originalLink" 
                    rows="4"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                    placeholder="Cole aqui o link completo que você recebeu no email...&#10;Exemplo: http://localhost:3000/#access_token=..."></textarea>
            </div>
            
            <button 
                onclick="fixLink()"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                <i class="fas fa-magic"></i>
                Corrigir e Usar Link
            </button>
            
            <div id="result" class="hidden">
                <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-green-800 font-semibold mb-2">
                        <i class="fas fa-check-circle mr-1"></i> Link Corrigido!
                    </p>
                    <p class="text-sm text-green-700 mb-3">Clique no botão abaixo para confirmar seu email:</p>
                    <a id="fixedLink" 
                       href="#"
                       class="inline-block w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition-colors text-center">
                        <i class="fas fa-check mr-2"></i>
                        Confirmar Email e Fazer Login
                    </a>
                </div>
            </div>
            
            <div id="error" class="hidden p-4 bg-red-50 border border-red-200 rounded-lg">
                <p class="text-red-800 font-semibold">
                    <i class="fas fa-exclamation-triangle mr-1"></i> Erro
                </p>
                <p class="text-sm text-red-700" id="errorMessage"></p>
            </div>
        </div>
        
        <div class="mt-8 pt-6 border-t border-gray-200">
            <h2 class="font-bold text-gray-800 mb-3">
                <i class="fas fa-info-circle mr-1"></i> Como funciona?
            </h2>
            <ol class="space-y-2 text-sm text-gray-600">
                <li><i class="fas fa-1 text-blue-600 mr-2"></i> Cole o link que você recebeu no email</li>
                <li><i class="fas fa-2 text-blue-600 mr-2"></i> Clique em "Corrigir e Usar Link"</li>
                <li><i class="fas fa-3 text-blue-600 mr-2"></i> Clique no botão verde que aparecerá</li>
                <li><i class="fas fa-4 text-blue-600 mr-2"></i> Seu email será confirmado e você será logado</li>
            </ol>
        </div>
        
        <div class="mt-6 text-center">
            <a href="/" class="text-blue-600 hover:text-blue-800 text-sm">
                <i class="fas fa-arrow-left mr-1"></i> Voltar para o site
            </a>
        </div>
    </div>
    
    <script>
        function fixLink() {
            const originalLink = document.getElementById('originalLink').value.trim()
            const resultDiv = document.getElementById('result')
            const errorDiv = document.getElementById('error')
            const fixedLinkEl = document.getElementById('fixedLink')
            const errorMessageEl = document.getElementById('errorMessage')
            
            // Hide previous results
            resultDiv.classList.add('hidden')
            errorDiv.classList.add('hidden')
            
            if (!originalLink) {
                errorMessageEl.textContent = 'Por favor, cole o link que você recebeu no email.'
                errorDiv.classList.remove('hidden')
                return
            }
            
            try {
                // Extract the hash part (everything after #)
                let hashPart = ''
                
                if (originalLink.includes('#')) {
                    hashPart = originalLink.split('#')[1]
                } else {
                    throw new Error('Link inválido: não contém o token (parte após #)')
                }
                
                if (!hashPart.includes('access_token=')) {
                    throw new Error('Link inválido: não contém access_token')
                }
                
                // Build the corrected link
                const correctBaseUrl = 'https://3000-ikpt0knkee9oqi1r0i931-8f57ffe2.sandbox.novita.ai'
                const correctedLink = `${correctBaseUrl}/#${hashPart}`
                
                // Show result
                fixedLinkEl.href = correctedLink
                resultDiv.classList.remove('hidden')
                
            } catch (error) {
                errorMessageEl.textContent = error.message
                errorDiv.classList.remove('hidden')
            }
        }
        
        // Auto-process if link is in clipboard on load
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const clipboardText = await navigator.clipboard.readText()
                if (clipboardText && clipboardText.includes('localhost:3000') && clipboardText.includes('access_token=')) {
                    document.getElementById('originalLink').value = clipboardText
                }
            } catch (err) {
                // Clipboard access denied, ignore
            }
        })
    </script>
</body>
</html>
